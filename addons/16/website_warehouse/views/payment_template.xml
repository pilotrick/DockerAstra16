<?xml version="1.0" encoding="utf-8"?>
<odoo>
	<template id="website_sale.checkout">
		<xpath expr="//t" position="replace">
			<t t-call="website.layout">
				<t t-set="additional_title">Shop - Checkout</t>
				<t t-set="no_footer" t-value="1" />
				<div id="wrap">
					<div class="container oe_website_sale py-2">
						<t t-set="same_shipping"
							t-value="bool(order.partner_shipping_id==order.partner_id or only_services)" />
						<div class="row">
							<div class="col-12">
								<t t-call="website_sale.wizard_checkout">
									<t t-set="step" t-value="20" />
								</t>
							</div>

							<div class="col-12 col-xl-auto order-xl-2 d-none d-xl-block">
								<t t-call="website_sale.cart_summary" />
							</div>
							<div class="col-12 col-xl order-xl-1 oe_cart">
								<div class="row">
									<div class="col-lg-12">
										<h3 class="o_page_header mt8">Billing Address</h3>
									</div>
									<div class="col-lg-6 one_kanban">
										<t t-call="website_sale.address_kanban">
											<t t-set='contact' t-value="order.partner_id" />
											<t t-set='selected' t-value="1" />
											<t t-set='readonly' t-value="1" />
										</t>
									</div>
								</div>
								<t t-if="not only_services" groups="sale.group_delivery_invoice_address">
									<div class="row">
										<div class="col-lg-12">
											<h3 class="o_page_header mt16 mb4">Shipping Address</h3>
										</div>
									</div>
									<div class="row all_shipping">
										<div class="col-lg-12">
											<div class="row mt8">
												<div class="col-md-12 col-lg-12 one_kanban">
													<form action="/shop/address" method="post" class=''>
														<input type="hidden" name="csrf_token" t-att-value="request.csrf_token()" />
														<a role="button" href="#"
															class='a-submit btn btn-secondary mb16 btn-block'>
															<i class="fa fa-plus-square" />
															<span>Add an address</span>
														</a>
													</form>
												</div>
												<t t-foreach="shippings" t-as="ship">
													<div class="col-md-12 col-lg-6 one_kanban">
														<t t-call="website_sale.address_kanban">
															<t t-set="actual_partner" t-value="order.partner_id" />
															<t t-set='contact' t-value="ship" />
															<t t-set='selected' t-value="order.partner_shipping_id==ship" />
															<t t-set='readonly' t-value="bool(len(shippings)==1)" />
															<t t-set='edit_billing' t-value="bool(ship==order.partner_id)" />
														</t>
													</div>
												</t>
											</div>
										</div>
									</div>
								</t>
								<!-- <div class="row"> <div class="col-lg-12"> <h3 class="o_page_header 
									mt8">Warehouse</h3> </div> <div class="col-lg-6 one_kanban"> <select class="form-control" 
									name="field1"> <option value="">Select Warehouse</option> <t t-foreach="warehouse" 
									t-as="wh"> <option t-att-value="wh.id"><t t-esc="wh.name"/><t t-set="warehouse_id" 
									t-value="wh.id"/></option> </t> </select> </div> </div> -->
								<div class="d-flex justify-content-between mt-3">
									<a role="button" href="/shop/cart" class="btn btn-secondary mb32">
										<i class="fa fa-chevron-left" />
										<span>Return to Cart</span>
									</a>
									<a role="button" href="/shop/confirm_order" class="btn btn-primary mb32">
										<span>Confirm</span>
										<i class="fa fa-chevron-right" />
									</a>
								</div>
							</div>
						</div>
					</div>
				</div>
			</t>
		</xpath>
	</template>
	<template id="website_sale.payment" name="Payment">
		<xpath expr="//t" position="replace">
			<t t-call="website.layout">
				<t t-set="additional_title">Shop - Select Payment Acquirer</t>
				<t t-set="no_footer">1</t>

				<div id="wrap">
					<div class="container oe_website_sale py-2">
						<div class="row">
							<div class='col-12'>
								<t t-call="website_sale.wizard_checkout">
									<t t-set="step" t-value="40" />
								</t>
							</div>
							<div class="col-12" t-if="errors">
								<t t-foreach="errors" t-as="error">
									<div class="alert alert-danger" t-if="error" role="alert">
										<h4>
											<t t-esc="error[0]" />
										</h4>
										<t t-esc="error[1]" />
									</div>
								</t>
							</div>
							<div class="col-12 col-xl-auto order-xl-2">
								<t t-call="website_sale.cart_summary" />
							</div>
							<div class="col-12 col-xl order-xl-1 oe_cart">
								<div class="card">
									<div class="card-body" id="shipping_and_billing">
										<a class='float-right no-decoration' href='/shop/checkout'>
											<i class="fa fa-edit" />
											Edit
										</a>
										<t t-set="same_shipping"
											t-value="bool(order.partner_shipping_id==order.partner_id or only_services)" />
										<div>
											<b>
												Billing
												<t t-if="same_shipping and not only_services"> &amp; Shipping</t>
												:
											</b>
											<span t-esc='order.partner_id'
												t-options="dict(widget='contact', fields=['address'], no_marker=True, separator=', ')"
												class="address-inline" />
										</div>
										<div t-if="not same_shipping and not only_services"
											groups="sale.group_delivery_invoice_address">
											<b>Shipping: </b>
											<span t-esc='order.partner_shipping_id'
												t-options="dict(widget='contact', fields=['address'], no_marker=True, separator=', ')"
												class="address-inline" />
										</div>
									</div>
								</div>

								<div class="oe_structure clearfix mt-3" id="oe_structure_website_sale_payment_1" />
								<div class="row">
									<div class="col-lg-12">
										<h3 class="o_page_header mt8">Warehouse</h3>
									</div>
									<div class="col-lg-6 one_kanban">
										<select t-attf-class="form-control s_website_form"
											name="field1" required="">
											<option value="">Select Warehouse</option>
											<t t-foreach="warehouse" t-as="wh">
												<option t-att-value="wh.id"
													t-att-selected="wh.id == (user.warehouse_id and user.warehouse_id.id or -1)">
													<t t-esc="wh.name" />
													<t t-set="warehouse_id" t-value="wh.id" />
												</option>
											</t>
										</select>
									</div>
								</div>
								<div class="oe_structure clearfix mt-3" id="oe_structure_website_sale_payment_1" />

								<t t-if="website_sale_order.amount_total">
									<div t-if="acquirers or tokens" id="payment_method" class="mt-3">
										<h3 class="mb24">Pay with </h3>
										<t t-call="payment.checkout">
											<t t-set="footer_template_id" t-value="'website_sale.payment_footer'" />
											<t t-set="submit_button_label">Pay Now</t>
											<t t-set="warehouse" t-value="warehouse" />
										</t>
									</div>
									<div t-if="not acquirers" class="mt-2">
										<a role="button" class="btn-link" groups="base.group_system"
											t-attf-href="/web#action=#{payment_action_id}">
											<i class="fa fa-arrow-right"></i>
											Add payment acquirers
										</a>
									</div>
									<div class="js_payment mt-3" t-if="not website_sale_order.amount_total"
										id="payment_method" name="o_website_sale_free_cart">
										<form target="_self" action="/shop/payment/validate"
											method="post">
											<input type="hidden" name="csrf_token" t-att-value="request.csrf_token()" />
											<t t-call="website_sale.payment_footer">
												<t t-set="submit_button_label">Confirm Order</t>
											</t>
										</form>
									</div>
								</t>
							</div>
						</div>
					</div>
					<div class="oe_structure" id="oe_structure_website_sale_payment_2" />
				</div>
			</t>
		</xpath>
	</template>

	<template id="payment.checkout" name="Payment Checkout">
		<!-- Variables description: - 'acquirers' - The payment acquirers compatible 
			with the current transaction - 'tokens' - The payment tokens of the current 
			partner and payment acquirers - 'default_token_id' - The id of the token 
			that should be pre-selected. Optional - 'fees_by_acquirer' - The dict of 
			transaction fees for each acquirer. Optional - 'show_tokenize_input' - Whether 
			the option to save the payment method is shown - 'reference_prefix' - The 
			custom prefix to compute the full transaction reference - 'amount' - The 
			amount to pay. Optional (sale_subscription) - 'currency' - The currency of 
			the transaction, as a `res.currency` record - 'partner_id' - The id of the 
			partner on behalf of whom the payment should be made - 'access_token' - The 
			access token used to authenticate the partner. - 'transaction_route' - The 
			route used to create a transaction when the user clicks Pay - 'landing_route' 
			- The route the user is redirected to after the transaction - 'footer_template_id' 
			- The template id for the submit button. Optional - 'invoice_id' - The id 
			of the account move being paid. Optional -->
		<form name="o_payment_checkout" class="o_payment_form mt-3 clearfix"
			t-att-data-reference-prefix="reference_prefix" t-att-data-amount="amount"
			t-att-data-currency-id="currency and currency.id"
			t-att-data-partner-id="partner_id" t-att-data-access-token="access_token"
			t-att-data-transaction-route="transaction_route"
			t-att-data-warehouse="warehouse" t-att-data-landing-route="landing_route"
			t-att-data-allow-token-selection="True" t-att-data-invoice-id="invoice_id">

			<t t-set="acquirer_count" t-value="len(acquirers) if acquirers else 0" />
			<t t-set="token_count" t-value="len(tokens) if tokens else 0" />
			<!-- Check the radio button of the default token, if set, or of the first 
				acquirer if it is the only payment option -->
			<t t-set="default_payment_option_id"
				t-value="default_token_id if default_token_id and token_count > 0
                        else acquirers[0].id if acquirer_count == 1 and token_count == 0
                        else None" />
			<t t-set="fees_by_acquirer" t-value="fees_by_acquirer or dict()" />
			<t t-set="footer_template_id" t-value="footer_template_id or 'payment.footer'" />
			<t t-set="warehouse" t-value="warehouse" />

			<div class="card">
				<!-- === Acquirers === -->
				<t t-foreach="acquirers" t-as="acquirer">
					<div name="o_payment_option_card" class="card-body o_payment_option_card">
						<label>
							<!-- === Radio button === -->
							<!-- Only shown if linked to the only payment option -->
							<input name="o_payment_radio" type="radio"
								t-att-checked="acquirer.id == default_payment_option_id"
								t-att-class="'' if acquirer_count + token_count > 1 else 'd-none'"
								t-att-data-payment-option-id="acquirer.id" t-att-data-provider="acquirer.provider"
								data-payment-option-type="acquirer" />
							<!-- === Acquirer name === -->
							<span class="payment_option_name">
								<b t-esc="acquirer.display_as or acquirer.name" />
							</span>
							<!-- === "Test Mode" badge === -->
							<span t-if="acquirer.state == 'test'" class="badge-pill badge-warning ml-1">
								Test Mode
							</span>
							<!-- === Extra fees badge === -->
							<t t-if="fees_by_acquirer.get(acquirer)">
								<span class="badge-pill badge-secondary ml-1">
									+
									<t t-esc="fees_by_acquirer.get(acquirer)"
										t-options="{'widget': 'monetary', 'display_currency': currency}" />
									Fees
								</span>
							</t>
						</label>
						<!-- === Payment icon list === -->
						<t t-call="payment.icon_list" />
						<!-- === Help message === -->
						<div t-if="acquirer.pre_msg" t-out="acquirer.pre_msg" class="text-muted ml-3" />
					</div>
					<!-- === Acquirer inline form === -->
					<div t-attf-id="o_payment_acquirer_inline_form_{{acquirer.id}}"
						name="o_payment_inline_form" class="card-footer d-none">
						<!-- === Inline form content (filled by acquirer) === -->
						<t
							t-if="acquirer.sudo()._should_build_inline_form(is_validation=False)">
							<t t-set="inline_form_xml_id" t-value="acquirer.sudo().inline_form_view_id.xml_id" />
							<div t-if="inline_form_xml_id" class="clearfix">
								<t t-call="{{inline_form_xml_id}}">
									<t t-set="acquirer_id" t-value="acquirer.id" />
								</t>
							</div>
						</t>
						<!-- === "Save my payment details" checkbox === -->
						<!-- Only included if partner is known and if the choice is given -->
						<t t-set="tokenization_required"
							t-value="acquirer._is_tokenization_required(provider=acquirer.provider)" />
						<label
							t-if="show_tokenize_input and acquirer.allow_tokenization and not tokenization_required">
							<input name="o_payment_save_as_token" type="checkbox" />
							Save my payment details
						</label>
					</div>
				</t>
				<!-- === Tokens === -->
				<t t-foreach="tokens" t-as="token">
					<div name="o_payment_option_card" class="card-body o_payment_option_card">
						<label>
							<!-- === Radio button === -->
							<input name="o_payment_radio" type="radio"
								t-att-checked="token.id == default_payment_option_id"
								t-att-data-payment-option-id="token.id" t-att-data-provider="token.provider"
								data-payment-option-type="token" />
							<!-- === Token name === -->
							<span class="payment_option_name" t-esc="token.name" />
							<!-- === "V" check mark === -->
							<t t-call="payment.verified_token_checkmark" />
						</label>
					</div>
					<!-- === Token inline form === -->
					<div t-attf-id="o_payment_token_inline_form_{{token.id}}" name="o_payment_inline_form"
						class="card-footer d-none" />
				</t>
			</div>
			<!-- === "Pay" button === -->
			<t t-call="{{footer_template_id}}">
				<t t-set="label">Pay</t>
				<t t-set="icon_class" t-value="'fa-lock'" />
			</t>
		</form>
	</template>

	<template inherit_id="website_sale.address" id="shop_address_extended"
		name="shop address extended">
		<xpath expr="//div[contains(@t-attf-class, 'div_state')]"
			position="after">
			<div class="container">
				<div class="row">
					<div class="col-lg-12">
						<h3 class="o_page_header mt8">Warehouse</h3>
					</div>
					<div class="col-lg-6 one_kanban mb-3">
						<select class="form-control s_website_form" name="warehouse_id">
							<option value="">Select Warehouse</option>
							<t t-foreach="warehouse" t-as="wh">
								<option t-att-value="wh.id"
									t-att-selected="wh.id == (user.warehouse_id and user.warehouse_id.id or -1)">
									<t t-esc="wh.name" />
									<t t-set="warehouse_id" t-value="wh.id" />
								</option>
							</t>
						</select>
					</div>
				</div>
			</div>
		</xpath>
	</template>
	<!-- <template id="payment_sale_note1" inherit_id="website_sale.payment" 
		name="Warehouses" customize_show="True"> -->
	<!-- <xpath expr="//div[@id='oe_structure_website_sale_payment_1']" position="before"> -->
	<!-- <div class="oe_structure clearfix mt-3" id="oe_structure_website_sale_payment_1"/> -->
	<!-- <div class="row"> -->
	<!-- <div class="col-lg-12"> -->
	<!-- <h3 class="o_page_header mt8">Warehouse</h3> -->
	<!-- </div> -->
	<!-- <div class="col-lg-6 one_kanban"> -->
	<!-- <select class="form-control" name="field1"> -->
	<!-- <option value="">Select Warehouse</option> -->
	<!-- <t t-foreach="warehouse" t-as="wh"> -->
	<!-- <option value="wh.id"><t t-esc="wh.name"/></option> -->
	<!-- </t> -->

	<!-- </select> -->
	<!-- </div> -->
	<!-- </div> -->
	<!-- </xpath> -->
	<!-- </template> -->

</odoo>